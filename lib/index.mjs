import{getCurrentInstance as e}from"vue";function o(e,o,r,t){return new(r||(r=Promise))(function(n,i){function l(e){try{c(t.next(e))}catch(e){i(e)}}function a(e){try{c(t.throw(e))}catch(e){i(e)}}function c(e){var o;e.done?n(e.value):(o=e.value,o instanceof r?o:new r(function(e){e(o)})).then(l,a)}c((t=t.apply(e,o||[])).next())})}function r(e){return e.endsWith(".global")}function t(e,o,t){const n=function(e){let o=e.replace(/^.*[\\/]/,"");return r(o)||(o=o.replace(/\.\w+$/,"")),o.replace(/^\d+\./,"")}(o);e.push({path:o,middleware:t,name:n,global:r(n)})}function n(e){const o=r=>{try{void 0===r?e():(Error,e(r))}catch(o){e(o)}o.called=!0};return o}function i(e,r){r&&e.config.globalProperties.$routerMiddlewares&&r.beforeEach((r,t,i)=>o(this,void 0,void 0,function*(){const o=e.config.globalProperties.$routerMiddlewares.filter(e=>{if(e.global)return!0;if(r.meta.middleware){const o=r.meta.middleware;if(Array.isArray(o))return o.indexOf(e.name)>=0;if(o===e.name)return!0}return!1});for(const{middleware:e}of o){const o=n(i);if(yield e(r,t,o),o.called)return}i()}))}function l(e,r){return o(this,void 0,void 0,function*(){e.config.globalProperties.$routerMiddlewares=yield function(e){return o(this,void 0,void 0,function*(){const o=(null==e?void 0:e.middlewares)||{},r=[],n=Object.keys(o);for(const e of n){const n=o[e],i=o=>{if("function"==typeof(n=o)&&"_isRouteMiddleware"in n&&n._isRouteMiddleware&&o._isRouteMiddleware)t(r,e,o);else for(const e in o){const r=o[e];i(r)}var n};"function"==typeof n?yield Promise.resolve(n()).then(i):i(n)}return r})}(r);const n=(null==r?void 0:r.router)||e.config.globalProperties.$router;return i(e,n)})}function a(o,r){const n=e();if(n){n.appContext.config.globalProperties.$routerMiddlewares||(n.appContext.config.globalProperties.$routerMiddlewares=[],n.appContext.config.globalProperties.$router&&i(n.appContext.app,n.appContext.config.globalProperties.$router));t(n.appContext.config.globalProperties.$routerMiddlewares,o,u(r))}}function c(o){const r=e();if(r){if(!r.appContext.config.globalProperties.$routerMiddlewares)return;const e=r.appContext.config.globalProperties.$routerMiddlewares,t=e.findIndex(e=>e.name===o);t>=0&&e.splice(t,1)}}function u(e){return Object.assign(e,{_isRouteMiddleware:!0})}"function"==typeof SuppressedError&&SuppressedError;const s={install:(e,o)=>{l(e,o).then(()=>{})}};export{a as addMiddleware,s as default,u as defineRouteMiddleware,c as removeMiddleware};
