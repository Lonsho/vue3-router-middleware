import{getCurrentInstance as e}from"vue";function o(e,o,r,t){return new(r||(r=Promise))(function(i,n){function l(e){try{d(t.next(e))}catch(e){n(e)}}function a(e){try{d(t.throw(e))}catch(e){n(e)}}function d(e){var o;e.done?i(e.value):(o=e.value,o instanceof r?o:new r(function(e){e(o)})).then(l,a)}d((t=t.apply(e,o||[])).next())})}function r(e){return e.endsWith(".global")}function t(e,o,t){const i=function(e){let o=e.replace(/^.*[\\/]/,"");return r(o)||(o=o.replace(/\.\w+$/,"")),o.replace(/^\d+\./,"")}(o);e.push({path:o,middleware:t,name:i,global:r(i)})}function i(e){const o=r=>{try{void 0===r?e():(Error,e(r))}catch(o){e(o)}o.called=!0};return o}function n(e,r){r?r.beforeEach((r,t,n)=>o(this,void 0,void 0,function*(){var o;e.config.globalProperties.$routerMiddlewaresReady&&(yield e.config.globalProperties.$routerMiddlewaresReady);const l=null===(o=e.config.globalProperties.$routerMiddlewares)||void 0===o?void 0:o.filter(e=>{var o;if(e.global)return!0;if(null===(o=r.meta)||void 0===o?void 0:o.middleware){const o=r.meta.middleware;if(Array.isArray(o))return o.indexOf(e.name)>=0;if(o===e.name)return!0}return!1});for(const{middleware:e}of l){const o=i(n);if(yield e(r,t,o),o.called)return}n()})):(()=>{o(this,void 0,void 0,function*(){yield e.config.globalProperties.$routerMiddlewaresReady})})()}function l(e,r){return o(this,void 0,void 0,function*(){e.config.globalProperties.$routerMiddlewaresReady=new Promise(i=>{(function(e){return o(this,void 0,void 0,function*(){const o=(null==e?void 0:e.middlewares)||{},r=[],i=Object.keys(o);for(const e of i){const i=o[e],n=o=>{if("function"==typeof(i=o)&&"_isRouteMiddleware"in i&&i._isRouteMiddleware&&o._isRouteMiddleware)t(r,e,o);else for(const e in o){const r=o[e];n(r)}var i};"function"==typeof i?yield Promise.resolve(i()).then(n):n(i)}return r})})(r).then(o=>{delete e.config.globalProperties.$routerMiddlewaresReady,e.config.globalProperties.$routerMiddlewares=o,i(o)})});const i=(null==r?void 0:r.router)||e.config.globalProperties.$router;return n(e,i)})}function a(o,r){const i=e();if(i){i.appContext.config.globalProperties.$routerMiddlewares||(i.appContext.config.globalProperties.$routerMiddlewares=[],i.appContext.config.globalProperties.$router&&n(i.appContext.app,i.appContext.config.globalProperties.$router));t(i.appContext.config.globalProperties.$routerMiddlewares,o,c(r))}}function d(o){const r=e();if(r){if(!r.appContext.config.globalProperties.$routerMiddlewares)return;const e=r.appContext.config.globalProperties.$routerMiddlewares,t=e.findIndex(e=>e.name===o);t>=0&&e.splice(t,1)}}function c(e){return Object.assign(e,{_isRouteMiddleware:!0})}"function"==typeof SuppressedError&&SuppressedError;const s={install:(e,r)=>o(void 0,void 0,void 0,function*(){yield l(e,r)})};export{a as addMiddleware,s as default,c as defineRouteMiddleware,d as removeMiddleware};
