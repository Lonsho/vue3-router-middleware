"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("vue");function r(e,r,o,t){return new(o||(o=Promise))(function(n,i){function l(e){try{a(t.next(e))}catch(e){i(e)}}function d(e){try{a(t.throw(e))}catch(e){i(e)}}function a(e){var r;e.done?n(e.value):(r=e.value,r instanceof o?r:new o(function(e){e(r)})).then(l,d)}a((t=t.apply(e,r||[])).next())})}function o(e){return e.endsWith(".global")}function t(e,r,t){const n=function(e){let r=e.replace(/^.*[\\/]/,"");return o(r)||(r=r.replace(/\.\w+$/,"")),r.replace(/^\d+\./,"")}(r);e.push({path:r,middleware:t,name:n,global:o(n)})}function n(e){const r=o=>{try{void 0===o?e():(Error,e(o))}catch(r){e(r)}r.called=!0};return r}function i(e,o){o?o.beforeEach((o,t,i)=>r(this,void 0,void 0,function*(){var r;e.config.globalProperties.$routerMiddlewaresReady&&(yield e.config.globalProperties.$routerMiddlewaresReady);const l=null===(r=e.config.globalProperties.$routerMiddlewares)||void 0===r?void 0:r.filter(e=>{var r;if(e.global)return!0;if(null===(r=o.meta)||void 0===r?void 0:r.middleware){const r=o.meta.middleware;if(Array.isArray(r))return r.indexOf(e.name)>=0;if(r===e.name)return!0}return!1});for(const{middleware:e}of l){const r=n(i);if(yield e(o,t,r),r.called)return}i()})):(()=>{r(this,void 0,void 0,function*(){yield e.config.globalProperties.$routerMiddlewaresReady})})()}function l(e,o){return r(this,void 0,void 0,function*(){e.config.globalProperties.$routerMiddlewaresReady=new Promise(n=>{(function(e){return r(this,void 0,void 0,function*(){const r=(null==e?void 0:e.middlewares)||{},o=[],n=Object.keys(r);for(const e of n){const n=r[e],i=r=>{if("function"==typeof(n=r)&&"_isRouteMiddleware"in n&&n._isRouteMiddleware&&r._isRouteMiddleware)t(o,e,r);else for(const e in r){const o=r[e];i(o)}var n};"function"==typeof n?yield Promise.resolve(n()).then(i):i(n)}return o})})(o).then(r=>{delete e.config.globalProperties.$routerMiddlewaresReady,e.config.globalProperties.$routerMiddlewares=r,n(r)})});const n=(null==o?void 0:o.router)||e.config.globalProperties.$router;return i(e,n)})}function d(e){return Object.assign(e,{_isRouteMiddleware:!0})}"function"==typeof SuppressedError&&SuppressedError;const a={install:(e,o)=>r(void 0,void 0,void 0,function*(){yield l(e,o)})};exports.addMiddleware=function(r,o){const n=e.getCurrentInstance();if(n){n.appContext.config.globalProperties.$routerMiddlewares||(n.appContext.config.globalProperties.$routerMiddlewares=[],n.appContext.config.globalProperties.$router&&i(n.appContext.app,n.appContext.config.globalProperties.$router));t(n.appContext.config.globalProperties.$routerMiddlewares,r,d(o))}},exports.default=a,exports.defineRouteMiddleware=d,exports.removeMiddleware=function(r){const o=e.getCurrentInstance();if(o){if(!o.appContext.config.globalProperties.$routerMiddlewares)return;const e=o.appContext.config.globalProperties.$routerMiddlewares,t=e.findIndex(e=>e.name===r);t>=0&&e.splice(t,1)}};
