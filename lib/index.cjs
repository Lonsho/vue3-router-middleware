"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("vue");function r(e,r,t,o){return new(t||(t=Promise))(function(n,i){function l(e){try{d(o.next(e))}catch(e){i(e)}}function a(e){try{d(o.throw(e))}catch(e){i(e)}}function d(e){var r;e.done?n(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(l,a)}d((o=o.apply(e,r||[])).next())})}function t(e){return e.endsWith(".global")}function o(e,r,o){const n=function(e){let r=e.replace(/^.*[\\/]/,"");return t(r)||(r=r.replace(/\.\w+$/,"")),r.replace(/^\d+\./,"")}(r);e.push({path:r,middleware:o,name:n,global:t(n)})}function n(e){const r=t=>{try{void 0===t?e():(Error,e(t))}catch(r){e(r)}r.called=!0};return r}function i(e,t){t&&e.config.globalProperties.$routerMiddlewares&&t.beforeEach((t,o,i)=>r(this,void 0,void 0,function*(){const r=e.config.globalProperties.$routerMiddlewares.filter(e=>{var r;if(e.global)return!0;if(null===(r=t.meta)||void 0===r?void 0:r.middleware){const r=t.meta.middleware;if(Array.isArray(r))return r.indexOf(e.name)>=0;if(r===e.name)return!0}return!1});for(const{middleware:e}of r){const r=n(i);if(yield e(t,o,r),r.called)return}i()}))}function l(e,t){return r(this,void 0,void 0,function*(){e.config.globalProperties.$routerMiddlewares=yield function(e){return r(this,void 0,void 0,function*(){const r=(null==e?void 0:e.middlewares)||{},t=[],n=Object.keys(r);for(const e of n){const n=r[e],i=r=>{if("function"==typeof(n=r)&&"_isRouteMiddleware"in n&&n._isRouteMiddleware&&r._isRouteMiddleware)o(t,e,r);else for(const e in r){const t=r[e];i(t)}var n};"function"==typeof n?yield Promise.resolve(n()).then(i):i(n)}return t})}(t);const n=(null==t?void 0:t.router)||e.config.globalProperties.$router;return i(e,n)})}function a(e){return Object.assign(e,{_isRouteMiddleware:!0})}"function"==typeof SuppressedError&&SuppressedError;const d={install:(e,r)=>{l(e,r).then(()=>{})}};exports.addMiddleware=function(r,t){const n=e.getCurrentInstance();if(n){n.appContext.config.globalProperties.$routerMiddlewares||(n.appContext.config.globalProperties.$routerMiddlewares=[],n.appContext.config.globalProperties.$router&&i(n.appContext.app,n.appContext.config.globalProperties.$router));o(n.appContext.config.globalProperties.$routerMiddlewares,r,a(t))}},exports.default=d,exports.defineRouteMiddleware=a,exports.removeMiddleware=function(r){const t=e.getCurrentInstance();if(t){if(!t.appContext.config.globalProperties.$routerMiddlewares)return;const e=t.appContext.config.globalProperties.$routerMiddlewares,o=e.findIndex(e=>e.name===r);o>=0&&e.splice(o,1)}};
